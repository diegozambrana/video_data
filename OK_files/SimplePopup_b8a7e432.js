define((function(){"use strict";var e=function(){},t=function(){},i=null;return e.prototype={hideCurrent:function(){i&&i.hide()},hide:function(){clearTimeout(this.hideTimerId),clearTimeout(this.showTimerId),this.visible&&(this.visible=!1,this===i&&(i=null),this.settings.onHide())},show:function(){this!==i&&this.hideCurrent(),clearTimeout(this.hideTimerId),clearTimeout(this.showTimerId),this.visible||(this.visible=!0,this.settings.onShow())},hideOnTimer:function(){clearTimeout(this.hideTimerId),clearTimeout(this.showTimerId),this.hideTimerId=setTimeout(this.hide.bind(this),this.settings.timeout)},showOnTimer:function(){this.settings.showTimeout>0?(clearTimeout(this.hideTimerId),clearTimeout(this.showTimerId),this.showTimerId=setTimeout(this.show.bind(this),this.settings.showTimeout)):this.show()},onClickHandler:function(){this.visible?this.settings.remainOnClick||this.hide():this.show()},toggleHandler:function(e){e.stopPropagation(),this.visible?this.hide():this.show()},onMouseenterHandler:function(){this.showOnTimer()},onTouchendHandler:function(){this.visible&&this.hideOnTimer()},processEvents:function(e){var t=this.settings.event.split(" "),i=this;i.trigger&&(t.forEach((function(t){switch(t){case"click":e.call(i.trigger,"click",i.triggerClickHandler);break;case"mouseenter":e.call(i.trigger,"mouseenter",i.triggerMouseenterHandler)}})),e.call(i.popup,"mouseenter",i.popupMouseenterHandler),this.triggerMouseleaveHandler&&e.call(i.trigger,"mouseleave",i.triggerMouseleaveHandler)),this.popupMouseleaveHandler&&e.call(i.popup,"mouseleave",i.popupMouseleaveHandler),OK.device.isTouch&&(i.trigger&&e.call(i.trigger,"touchend",i.triggerTouchendHandler),e.call(document.body,"touchend",i.bodyTouchendHandler)),this.settings.toggleControl&&e.call(this.settings.toggleControl,"click",i.toggleClickHandler)},create:function(e,i,s){i&&(this.trigger=e,this.popup=i,this.showTimerId=null,this.hideTimerId=null,this.visible=!1,s.timeout=0!==s.timeout?s.timeout:1,this.settings={event:s.event||"click",timeout:s.timeout||800,showTimeout:s.showTimeout||0,remainOnClick:s.remainOnClick||!1,onShow:s.onShow||t,onHide:s.onHide||t,toggleControl:s.toggleControl},this.triggerClickHandler=this.onClickHandler.bind(this),this.triggerMouseenterHandler=this.onMouseenterHandler.bind(this),this.popupMouseenterHandler=this.showOnTimer.bind(this),this.bodyTouchendHandler=this.onTouchendHandler.bind(this),this.triggerTouchendHandler=function(e){e.stopPropagation()},OK.logging.isSeleniumBot||(this.triggerMouseleaveHandler=this.hideOnTimer.bind(this),this.popupMouseleaveHandler=this.hideOnTimer.bind(this)),this.settings.toggleControl&&(this.toggleClickHandler=this.toggleHandler.bind(this)),this.processEvents(window.Element.prototype.addEventListener))},getElement:function(e){return e?"#"===e.charAt(0)?document.getElementById(e.slice(1)):document.querySelector(e):null},activate:function(e){var t=this.getElement(e.getAttribute("data-trigger-selector")),i=t||e,s=e.hasAttribute("data-popup-local-selector")?e.querySelector(e.getAttribute("data-popup-local-selector")):this.getElement(e.getAttribute("data-popup-selector")),o=e.getAttribute("data-popup-active-class")||null,n=e.getAttribute("data-popup-hidden-class")||"",r=parseInt(e.getAttribute("data-timeout"),10),l=parseInt(e.getAttribute("data-show-timeout"),10),h=e.getAttribute("data-event"),a=e.getAttribute("data-active-class")||"",d=e.hasAttribute("data-remain-on-click"),u=e.hasAttribute("data-toggle-selector")?e.querySelector(e.getAttribute("data-toggle-selector")):null;null!==o&&-1===o.indexOf(" ")||OK.fn.isDebug()&&(window.console.log("OK/SimplePopup bad usage on",s,' Use "data-popup-active-class"'),window.alert("OK/SimplePopup bad usage. See console log for details")),this.create(i,s,{timeout:r,showTimeout:l,event:h,remainOnClick:d,toggleControl:u,onShow:function(){s.classList.add(o),s.getBoundingClientRect().bottom>window.innerHeight&&s.classList.add("__top"),n&&s.classList.remove(n),a&&i.classList.add(a)},onHide:function(){s.classList.remove(o,"__top"),n&&s.classList.add(n),a&&i.classList.remove(a)}}),e.hasAttribute("data-expanded")&&this.show()},deactivate:function(){this.processEvents(window.Element.prototype.removeEventListener)}},e}));